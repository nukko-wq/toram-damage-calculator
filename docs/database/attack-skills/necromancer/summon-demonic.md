# サモンデモニック(MP2000消費・強攻撃) スキル追加仕様書

## 概要

AttackSkillFormに新しい攻撃スキル「サモンデモニック」を追加するための詳細仕様書です。設計書`attack-skill-form.md`と`attack-skill-calculation.md`に基づいて、系統的にスキルデータを定義します。

## 基本情報

- **スキル名**: サモンデモニック(MP2000消費・強攻撃)
- **スキルID**: `summon_demonic`
- **系統グループ**: `necromancer` (ネクロマンサー系統)
- **カテゴリ**: `necromancer` (ネクロマンサースキル)
- **武器種要件**: なし（全武器対応）
- **消費MP**: 2000
- **攻撃種別**: 強攻撃
- **表示順序**: 304 (300番台: ネクロマンサー系統)

## データ構造定義

### AttackSkill オブジェクト

```typescript
{
  // 基本情報
  id: 'summon_demonic',
  name: 'サモンデモニック(MP2000消費・強攻撃)',
  order: 304,                    // ネクロマンサー系統300番台
  systemGroup: 'necromancer',    // ネクロマンサー系統
  category: 'necromancer',       // ネクロマンサーカテゴリ
  weaponTypeRequirements: [],    // 武器種制限なし（全武器対応）
  
  // 消費・条件
  mpCost: 2000,
  isStrongAttack: true,          // 強攻撃
  
  // 表示用計算式説明
  multiplierFormula: '200+90x2000/100',     // 威力計算式
  fixedDamageFormula: '2000',    // 固定ダメージ
  
  // 攻撃情報（1hit攻撃、仮設定）
  hits: [
    {
      hitNumber: 1,
      attackType: 'physical',     // 物理攻撃
      referenceDefense: 'DEF',    // DEF参照
      referenceResistance: 'physical', // 物理耐性参照
      powerReference: 'ATK_MATK', // ATK+MATK参照
      multiplier: 2000,           // 威力倍率 200+90x2000/100=2000%
      fixedDamage: 2000,          // 固定2000ダメージ
      adaptation: 'normal',       // 慣れ参照（通常攻撃慣れ）
      adaptationGrant: 'normal',  // 慣れ付与（通常攻撃慣れ）
      canUseUnsheathePower: false,   // 抜刀威力適用不可
      canUseLongRange: false,        // ロングレンジ適用不可
      canUseShortRangePower: false,  // 近距離威力適用不可
      canUseLongRangePower: false    // 遠距離威力適用不可
    }
  ]
}
```

## 計算仕様

### 計算タイプ
- **計算方式**: 保留（未定）
- **攻撃回数**: 保留（未定）
- **威力倍率**: 2000% (200+90x2000/100)
- **固定ダメージ**: 2000
- **特殊計算**: 保留（未定）

### 計算処理

計算方式は現在保留中です。今後の検討により標準計算または特殊計算が選択される予定です。

```typescript
// 計算方式は今後決定予定
// StandardCalculatorまたは専用Calculatorを使用
```

## UI表示仕様

### スキル選択ドロップダウン
- **表示位置**: ネクロマンサー系統グループ内、order順で表示
- **表示名**: `サモンデモニック(MP2000消費・強攻撃)`
- **武器種フィルタ**: なし（全武器種で表示）
- **強攻撃マーク**: 表示（isStrongAttack: true）

### スキル情報表示
```
📊 サモンデモニック(MP2000消費・強攻撃) [強攻撃]
　　カテゴリ: ネクロマンサー系 | 消費MP: 2000
　　威力参照: ATK+MATK | タイプ: 物理攻撃
　　慣れ参照: 通常攻撃 | 慣れ付与: 通常攻撃
　　参照防御力: DEF | 参照耐性: 物理
　　距離威力: 近距離×遠距離× | 抜刀威力: × | ロングレンジ: ×

🎯 スキル威力値
　　1hit: 倍率: 2000% | 固定値: 2000
　　合計威力: 2000% | 合計固定値: 2000
　　特殊効果: 保留
```

### 詳細情報
```
📋 詳細情報 [▼]
　　必要武器: なし（全武器対応）
　　前提スキル: 保留
　　特殊効果: 保留
　　距離補正: 近距離×、遠距離×、ロングレンジ×、抜刀威力×
　　計算方式: 保留
　　備考: ネクロマンサー系統の強攻撃スキル、消費MP2000、固定ダメージ2000
```

## 実装ファイル更新

### 1. src/data/attackSkills.ts
既存の`attackSkillsRawData`配列に新しいスキルオブジェクトを追加（保留状態で）

### 2. src/utils/attackSkillCalculation/AttackSkillCalculator.ts
`getCalculatorForSkill`メソッドに`summon_demonic`ケースを追加（計算方式決定後）

### 3. 専用計算機（必要に応じて）
特殊計算が必要な場合は`SummonDemonicCalculator.ts`を作成

### 4. 型定義更新
必要に応じて新しい型定義を追加

## 現在の実装状況

### 確定済み
- **スキル名**: サモンデモニック(MP2000消費・強攻撃)
- **消費MP**: 2000
- **固定ダメージ**: 2000
- **系統**: ネクロマンサー系統
- **攻撃種別**: 強攻撃

### 保留中
- **武器種要件**: なし（全武器対応）【確定済み】
- **攻撃タイプ**: physical（物理攻撃）【確定済み】
- **威力倍率**: 2000% (200+90x2000/100) 【確定済み】
- **威力参照**: ATK+MATK【確定済み】
- **慣れ設定**: normal/normal（通常攻撃慣れ参照・付与）【確定済み】
- **参照防御力**: DEF【確定済み】
- **参照耐性**: physical【確定済み】
- **距離・抜刀補正**: 全て不適用（false）【確定済み】
- **特殊効果**: 有無・内容
- **計算方式**: 標準/特殊
- **攻撃回数**: 1hit/多段攻撃

### 未実装
- 完全なスキルデータ定義
- 計算機実装
- テストケース

## テストケース（実装後）

### 基本テスト
```typescript
describe('サモンデモニック Skill', () => {
  test('スキルデータの取得', () => {
    const skill = getAttackSkillById('summon_demonic')
    expect(skill).toBeDefined()
    expect(skill?.name).toBe('サモンデモニック(MP2000消費・強攻撃)')
    expect(skill?.mpCost).toBe(2000)
    expect(skill?.isStrongAttack).toBe(true)
    expect(skill?.hits).toHaveLength(1)
    expect(skill?.hits[0].fixedDamage).toBe(2000)
  })
  
  test('強攻撃の判定', () => {
    const skill = getAttackSkillById('summon_demonic')
    expect(skill?.isStrongAttack).toBe(true)
  })
  
  test('計算機の動作確認', () => {
    // 実装後に詳細テストを追加
  })
})
```

## 実装優先度

### Phase 1: 基本実装
1. **スキルデータ追加**: 保留項目を含む基本データ構造
2. **UI表示**: スキル選択・情報表示の基本機能（保留表示含む）
3. **強攻撃マーク**: 強攻撃スキルとしてのUI表示

### Phase 2: 仕様確定
1. **武器種要件決定**: 必要武器種の決定
2. **攻撃タイプ決定**: physical/magicalの決定
3. **威力計算式確定**: 具体的な計算方式・数値の決定
4. **特殊効果決定**: 特殊効果の有無・内容の決定

### Phase 3: 完全実装
1. **計算機実装**: 確定した仕様による計算処理
2. **テスト実装**: 完全なテストケース
3. **ドキュメント更新**: 最終仕様書の更新

## 将来の拡張

### 関連スキル
- 他のネクロマンサー系スキルとの連携
- サモン系スキルのシリーズ化
- 強攻撃系スキルとのカテゴリ統一

### 計算式候補
- **魔法系**: MATK参照、MDEF・魔法耐性参照
- **物理系**: ATK参照、DEF・物理耐性参照  
- **特殊系**: 複合参照、特殊計算式
- **召喚系**: 特殊な召喚メカニズム

### UI改善
- ネクロマンサー系スキルの統一表示
- 強攻撃スキルの専用表示
- 保留項目の視覚的区別
- 仕様確定状況の表示

## 備考

この仕様書はサモンデモニックスキルの設計書です。現在、基本情報（スキル名・消費MP・固定ダメージ・強攻撃属性）のみが確定しており、その他の仕様は今後の検討待ちです。

### 確定している要素
1. **スキル名**: サモンデモニック
2. **消費MP**: 2000
3. **固定ダメージ**: 2000
4. **系統分類**: ネクロマンサー系統
5. **攻撃種別**: 強攻撃
6. **威力倍率**: 2000% (200+90x2000/100)
7. **慣れ設定**: normal（通常攻撃慣れ参照・付与）
8. **距離・抜刀補正**: 全て不適用（近距離×、遠距離×、ロングレンジ×、抜刀威力×）
9. **攻撃タイプ**: physical（物理攻撃）
10. **参照防御力**: DEF
11. **参照耐性**: physical（物理耐性）
12. **武器種要件**: なし（全武器対応）
13. **威力参照**: ATK+MATK（特殊参照）

### 検討が必要な要素
1. ~~**武器種要件**: 必要武器種の決定~~ 【確定済み】
2. ~~**攻撃タイプ**: physical/magicalの選択~~ 【確定済み】
3. ~~**威力参照**: ATK/MATK/totalATKの選択~~ 【確定済み】
4. ~~**参照防御力**: DEF/MDEFの選択~~ 【確定済み】
5. ~~**参照耐性**: physical/magicalの選択~~ 【確定済み】
6. ~~**慣れ設定**: 参照・付与タイプの決定~~ 【確定済み】
7. ~~**距離・抜刀補正**: 適用可否の決定~~ 【確定済み】
8. **攻撃回数**: 1hit/多段攻撃の決定
9. **威力倍率**: 計算式・数値の決定
10. **特殊効果**: 召喚効果等の追加効果
11. **計算方式**: 標準/特殊計算の選択

実装は段階的に進める予定で、まず基本データ構造を作成し、仕様確定後に完全な機能を実装する方針です。特に強攻撃としての特徴や召喚系スキルとしての特殊性を今後検討する必要があります。