# ストームブレイザー(1スタック) スキル追加仕様書

## 概要

AttackSkillFormに新しい攻撃スキル「ストームブレイザー(1スタック)」を追加するための詳細仕様書です。設計書`attack-skill-form.md`と`attack-skill-calculation.md`に基づいて、系統的にスキルデータを定義します。

## 基本情報

- **スキル名**: ストームブレイザー(1スタック)
- **スキルID**: `storm_blazer_1stack`
- **系統グループ**: `sword` (剣系統)
- **カテゴリ**: `blade` (ブレードスキル)
- **武器種要件**: `両手剣`
- **消費MP**: 200
- **表示順序**: 108 (ストームブレイザー(10スタック)の後)

## データ構造定義

### AttackSkill オブジェクト（基本構造）

```typescript
{
  // 基本情報
  id: 'storm_blazer_1stack',
  name: 'ストームブレイザー(1スタック)',
  order: 108,                    // ストームブレイザー(10スタック)の後
  systemGroup: 'sword',          // 剣系統
  category: 'blade',             // ブレードカテゴリ
  weaponTypeRequirements: ['両手剣'],
  
  // 消費・条件
  mpCost: 200,
  
  // 表示用計算式説明
  multiplierFormula: '75%',      // 倍率75%
  fixedDamageFormula: '150+補正後VIT', // 固定ダメージ（VIT依存）
  
  // 攻撃情報
  hits: [
    {
      hitNumber: 1,
      attackType: 'physical',
      referenceDefense: 'DEF',
      referenceResistance: 'physical',
      powerReference: 'ATK',      // 威力参照ステータス
      
      // 表示用倍率・固定値
      multiplier: 75,             // 表示用倍率75%
      fixedDamage: 150,           // 表示用固定値（実際は+補正後VIT）
      
      // 計算式説明
      multiplierFormula: '75%',   // 倍率計算式
      fixedDamageFormula: '150+補正後VIT', // 固定値計算式
      
      // 慣れ設定
      adaptation: 'physical',     // 物理慣れ参照
      adaptationGrant: 'physical', // 物理慣れ付与
      
      // 補正適用設定
      canUseUnsheathePower: false, // 抜刀威力適用不可
      canUseLongRange: true,       // ロングレンジ適用可能
      canUseShortRangePower: true, // 近距離威力適用可能
      canUseLongRangePower: true,  // 遠距離威力適用可能
    }
  ]
}
```

## 仕様決定項目

### 基本仕様
- [x] **消費MP**: 200
- [x] **武器種要件**: 両手剣
- [x] **基本倍率**: 75%
- [x] **固定ダメージ**: 150+補正後VIT
- [x] **表示順序**: 106 (剣系統100番台)
- [x] **撃数**: 単発攻撃
- [x] **計算方式**: 専用計算（VIT依存固定ダメージ）

### 威力・ダメージ仕様
- [x] **基本倍率**: 75%（確定）
- [x] **固定ダメージ**: 150+補正後VIT（確定）
- [x] **武器種別補正**: なし
- [x] **特殊計算**: 補正後VIT依存計算の実装

### 補正適用仕様
- [x] **抜刀威力**: 適用不可 (canUseUnsheathePower: false)
- [x] **ロングレンジ**: 適用可能 (canUseLongRange: true)
- [x] **距離威力**: 近距離威力適用可能 (canUseShortRangePower: true)、遠距離威力適用可能 (canUseLongRangePower: true)
- [x] **慣れ付与**: 物理慣れ付与 (adaptation: 'physical', adaptationGrant: 'physical')

### 特殊効果仕様
- [ ] **クリティカル**: 確定クリティカルの有無
- [ ] **貫通効果**: 貫通ボーナス等の特殊効果
- [ ] **状態異常**: 付与する状態異常効果
- [ ] **スタック関連**: 1スタック時の特殊効果
- [ ] **その他効果**: その他の特殊効果

## UI表示仕様

### スキル選択ドロップダウン
- **表示位置**: 剣系統グループ内、order順でストームブレイザー(10スタック)(107)の後
- **表示名**: `ストームブレイザー(1スタック)`
- **武器種フィルタ**: 両手剣装備時のみ表示

### スキル情報表示
```
📊 ストームブレイザー(1スタック)
　　カテゴリ: 剣系 | 消費MP: 200
　　威力参照: ATK | タイプ: 物理スキル
　　慣れ参照: 物理 | 慣れ付与: 物理
　　参照防御力: DEF | 参照耐性: 物理
　　距離威力: 近距離○遠距離○ | 抜刀威力: × | ロングレンジ: ○

🎯 スキル威力値
　　倍率: 75% | 固定値: 150+補正後VIT
　　特殊効果: TBD
```

### 詳細情報
```
📋 詳細情報 [▼]
　　必要武器: 両手剣
　　前提スキル: TBD
　　特殊効果: 1スタックバフ、TBD
　　計算方式: 専用計算（VIT依存固定ダメージ）
　　備考: スタック依存の両手剣専用スキル
```

## 実装ファイル更新予定

### 1. src/data/attackSkills.ts
既存の`attackSkillsRawData`配列に新しいスキルオブジェクトを追加

### 2. src/utils/attackSkillCalculation/AttackSkillCalculator.ts
`getCalculatorForSkill`メソッドに`storm_blazer_1stack`ケースを追加

### 3. 計算機実装
`StormBlazer1StackCalculator`専用クラスを作成（補正後VIT依存、倍率100%）

### 4. 型定義確認
`src/types/calculator.ts`の`AttackSkillCategory`に`blade`が既に含まれていることを確認

## 実装優先度

### 完了済み
- スキルの基本情報設定（名前、ID、系統、カテゴリ、武器種要件）
- 消費MP設定（200）
- 基本倍率設定（75%）
- 固定ダメージ設定（150+補正後VIT）
- 補正適用設定（抜刀威力×、ロングレンジ○、近距離威力○、遠距離威力○）
- 慣れ設定（adaptation: 'physical', adaptationGrant: 'physical'）
- 表示順序設定（106）
- データ構造の基本枠組み定義
- UI表示の基本枠組み

### 仕様決定待ち（低優先度）
1. **特殊効果の決定**: 1スタック関連効果、その他の特殊効果

### 実装予定（高優先度）
1. **スキルデータ追加**: `attackSkills.ts`への追加
2. **計算器作成**: `StormBlazer1StackCalculator`専用計算クラス作成（倍率75%、固定値150+VIT依存）
3. **計算器連携**: `AttackSkillCalculator.ts`の更新
4. **テスト実装**: 単体・統合テスト

## 将来の拡張

### 関連スキル
- 他のストームブレイザー系スキル（2-9スタック）の追加
- ブレード系スキルとの統一性
- 両手剣系スキルのグループ化

### 計算式拡張
- スタック数による威力変動システム
- 装備ボーナスの適用
- バフ効果との連携
- 敵状態による補正適用

### UI改善
- スタック数表示機能
- ブレード系スキルのグループ化表示
- スキル系統の視覚的区別
- 計算過程の詳細表示

## 備考

この仕様書は、ストームブレイザー(10スタック)の設計書を基に、倍率を1000%から75%、固定ダメージを200+補正後VITから150+補正後VITに変更し、表示順序を106に設定したものです。

固定ダメージ計算（150+補正後VIT）はVIT依存計算を使用し、専用の計算ロジックが必要になります。

## 次のステップ

1. **実装**: 上記仕様に基づいてスキルデータと計算機を実装
2. **テスト**: 実装したスキルの動作確認とテスト
3. **統合**: 既存のストームブレイザー(10スタック)との整合性確認

## 補正後VIT依存について

固定ダメージが「150+補正後VIT」となっているため、プレイヤーの補正後VITステータスを取得する必要があります。これは既存のストームブレイザー(10スタック)と同様の実装方式を使用します：

- 固定ダメージ計算時に補正後VITの取得
- VIT依存計算の実装（基準値150+VIT）
- UI上での固定ダメージ表示の動的更新

この部分の実装方式は、既存の`StormBlazer10StackCalculator`を参考にして、基準値を150に変更して実装します。