# 装備システム

## 装備カテゴリ
- メイン装備
- 体装備
- 追加装備
- 特殊装備
- サブ武器
- オシャレ装備1
- オシャレ装備2
- オシャレ装備3
- 自由入力1
- 自由入力2
- 自由入力3
- レジスタ他
- 武器クリスタ
- 防具クリスタ
- 追加クリスタ
- 特殊クリスタ

## 装備プリセット選択機能
- プリセット装備: JSONファイルで管理（`src/data/equipments.json`）
- ユーザーカスタム装備: LocalStorageで管理
- データ統合: プリセット + ユーザーカスタムを統合してリスト表示

## 装備選択UI
- タブ切り替え式装備管理画面（11の装備スロット対応）
- 各装備スロットでプリセット選択機能
- オーバーレイモーダル方式での装備選択画面（クリスタ選択と同一UI）
- グリッドレイアウトでの装備一覧表示
- 装備カード形式（名前、基本性能、プロパティ表示）
- 装備タイプ別フィルタリング（武器/防具/アクセサリ/オシャレ等）
- 手動プロパティ入力機能との併用（プリセット選択後に微調整可能）
- 背景クリック・ESCキーでモーダル閉じる
- 検索・絞り込み機能（将来実装予定）

## 全装備スロットのカスタム機能
- **対象装備スロット**：メイン装備、体装備、追加装備、特殊装備、サブ武器、オシャレ1、オシャレ2、オシャレ3、自由入力1、自由入力2、自由入力3（全11スロット）
- **新規作成機能**：各装備スロットでプリセット選択ボタンの右に「新規作成」ボタン配置
- **装備名入力モーダル**：新規作成時にカスタム装備名を入力するモーダル表示、初期値は空文字列
- **プロパティ初期化**：新規作成時は全プロパティをリセット状態で開始、武器系装備は武器ステータス（ATK、安定率、精錬値）も初期化
- **自由入力スロット**：自由入力1～3は純粋なプロパティ試行用スロットで、プリセット選択なし、新規作成・名前変更・削除のみ対応
- **自動装備セット**：新規作成完了後、作成した装備を自動的に該当装備スロットにセット
- **カスタム装備名前変更機能**：新規作成ボタンと削除ボタンの間に「名前変更」ボタン配置、カスタム装備選択時のみ表示
- **名前変更モーダル**：カスタム装備名を編集するためのフォームモーダル表示、現在の名前を初期値として設定
- **名前変更確定機能**：モーダル内で新しい装備名を入力し、確定ボタンで名前を更新
- **カスタム装備削除機能**：名前変更ボタンの右に「削除」ボタン配置、カスタム装備選択時のみ表示
- **削除確認モーダル**：カスタム装備削除時の確認ダイアログをモーダル表示、装備名と装備カテゴリを表示
- **プリセット装備保護**：システム提供のプリセット装備は名前変更・削除ボタンを表示せず、変更・削除不可
- **プリセット選択統合**：カスタム装備をプリセット選択モーダルで選択可能、装備カテゴリ別にフィルタリング
- **グローバル共有**：カスタム装備は全セーブデータ間で共有利用可能
- **カスタム装備識別**：プリセット選択モーダル内でカスタム装備を視覚的に区別表示

## メイン装備専用機能
- **メイン武器情報登録機能**：メイン装備カテゴリでのみ利用可能な専用機能
- **メイン武器情報登録ボタン**：装備の選択フォームの下に「メイン武器情報登録」ボタンを配置、装備選択時のみ表示
- **武器データ連携**：ボタン押下時にWeaponFormで設定されたメイン武器の値（武器ATK、安定率、精錬値）を取得
- **装備データ更新**：取得した武器データを現在選択中の装備のLocalStorageデータに自動保存
- **対象データ項目**：
  - 武器ATK（WeaponForm内のメイン武器ATK値）
  - 安定率（WeaponForm内のメイン武器安定率値）
  - 精錬値（WeaponForm内のメイン武器精錬値）
- **保存先**：現在選択中の装備データ（プリセット装備・カスタム装備問わず、LocalStorageに保存）
- **グローバル共有**：登録した武器情報は全セーブデータ間で共有される（装備データと同様の共有方式）
- **UI更新**：保存完了後、装備プロパティ表示とWeaponFormの表示を自動更新
- **武器情報削除機能**：メイン武器情報登録ボタンの右に「武器情報削除」ボタンを配置
- **削除対象データ**：登録済みの武器ATK、安定率、精錬値をデフォルト値（0または初期値）にリセット
- **削除完了メッセージ**：削除実行後に「武器情報を削除しました。」のメッセージをモーダルで表示
- **登録完了メッセージ**：登録実行後に「武器情報を登録しました。」のメッセージをモーダルで表示
- **削除後UI更新**：削除完了後、装備プロパティ表示とWeaponFormの表示を自動更新
- **装備選択時の武器情報自動適用**：メイン装備の選択フォームから装備を選択した際、その装備に登録済みの武器情報（武器ATK、安定率、精錬値）がある場合、WeaponFormの対応する値を自動的に更新
- **武器情報の双方向連携**：装備選択 → WeaponForm更新、WeaponForm → 装備データ登録の双方向でデータ同期を実現

## カスタム装備プロパティ連動機能
- プロパティ変更時の仮データ反映：カスタム装備をセット中にプロパティを変更した場合、LocalStorageの永続データは変更せず、仮データにのみ反映
- フォーム優先表示：プロパティフォームは常に現在の編集値（仮データ）を表示、装備選択UIも仮データの値を反映
- 編集状態の分離：永続データと編集中データを完全に分離し、保存操作時のみ永続データを更新
- 装備選択UI連動：装備選択モーダル内の装備表示においても、現在フォームで設定されている値（編集中の値）を表示し、プロパティ変更がリアルタイムで反映される

## カスタム装備保存システム
- 二段階データ管理：新規作成時とプロパティ編集時は仮データ、保存時のみ永続データ更新
- セーブ時永続化：「現在のデータを保存」実行時に仮データ（編集内容）をLocalStorageに永続保存
- 編集破棄機能：保存せずにセーブデータ切り替えやブラウザリロード時は仮データを削除し、永続データを復元
- 保存状態管理：編集中カスタム装備の存在を視覚的に表示（保存ボタンのオレンジ色表示等）

## データ管理フロー例
1. カスタム武器を作成し、ATK=5で保存済み（永続データ：ATK=5）
2. 武器を選択してATK=10に変更（仮データ：ATK=10、永続データ：ATK=5のまま）
3. 保存ボタンを押す → 永続データをATK=10に更新
4. 保存せずリロード/切り替え → 仮データ削除、永続データ（ATK=5）を復元

## セーブデータ固有の編集セッション管理
- 編集セッションはセーブデータIDと装備IDの組み合わせで管理（例：`save1:weapon1`）
- セーブデータ切り替え時は前のセーブデータの編集セッションのみをクリーンアップ
- 異なるセーブデータ間で編集セッションが混在することを防止
- 各セーブデータで独立した編集状態を維持

## 装備データ構造
- 装備ID、装備名、装備タイプ
- 基本性能（ATK、DEF、安定率等）
- 付与プロパティ（各種%効果、固定値効果）
- 特殊プロパティ（体装備の防具の改造等）

## 体装備の防具の改造システム

### 防具の改造プロパティ（ArmorType）
- **設定対象**: 体装備のみ（他の装備スロットには適用されない）
- **選択可能な値**:
  - `normal`: 通常（デフォルト値）
  - `heavy`: 重量化
  - `light`: 軽量化
- **デフォルト値**: `normal`（通常）
- **設定場所**: 体装備のプリセット装備選択UIとプロパティGridの間

### 防具の改造UI設計
- **UI配置**: 体装備セクションのプリセット装備選択ボタンとプロパティGridの間にボタングループを配置
- **表示形式**: 3つのボタンによる排他選択形式
  - 「通常」ボタン（デフォルト選択状態）
  - 「重量化」ボタン
  - 「軽量化」ボタン
- **視覚的フィードバック**: 選択中のボタンをハイライト表示、非選択のボタンはグレーアウト
- **アクセシビリティ**: ラジオボタンの役割を持つボタングループ、キーボードナビゲーション対応

### データ保存仕様
- **保存先**: 各装備データ内（プリセット装備・ユーザーカスタム装備共通）
- **保存形式**: 装備オブジェクト内に`armorType`プロパティとして保存
- **初期値管理**: 新規装備作成時はデフォルト値`normal`を設定
- **グローバル共有**: 装備データに保存されるため、全セーブデータ間で共有される
- **装備固有設定**: 同じ装備を選択すれば、どのセーブデータでも同じ`armorType`が適用される

### 計算への影響
- **Phase 3実装予定**: 現在の実装フェーズでは計算には影響しない（UI・データ保存のみ）
- **将来実装**: 防具の改造により体装備の基本性能やプロパティに修正係数を適用予定

## 各装備のプロパティ

### プロパティ設定値の範囲
- %系プロパティ: -1000 ～ 1000
- 固定値プロパティ: -99999 ～ 99999

### プロパティ一覧
- ATK%
- ATK
- MATK%
- MATK
- 武器ATK%
- 武器ATK
- 物理貫通%
- 魔法貫通%
- 属性有利%
- 抜刀威力%
- 抜刀威力
- 近距離威力%
- 遠距離威力%
- クリティカルダメージ%
- クリティカルダメージ
- クリティカル率%
- クリティカル率
- 安定率%
- HP%
- HP
- MP
- STR%
- STR
- INT%
- INT
- VIT%
- AGI%
- AGI
- DEX%
- DEX
- 命中%
- 命中
- 回避%
- 回避
- 攻撃速度%
- 攻撃速度
- 詠唱速度%
- 詠唱速度
- 行動速度%
- 攻撃MP回復%
- 攻撃MP回復
- 物理耐性%
- 魔法耐性%
- 異常耐性%
- ヘイト%
- 復帰短縮%
- HP自然回復%
- HP自然回復
- MP自然回復%
- MP自然回復
- 防御崩し%
- 先読み%
- Guard力%
- Guard回復%
- Avoid回復%
- 道具速度
- 絶対命中%
- 絶対回避%
- ATK+(STR)%
- ATK+(INT)%
- ATK+(VIT)%
- ATK+(AGI)%
- ATK+(DEX)%
- MATK+(STR)%
- MATK+(INT)%
- MATK+(VIT)%
- MATK+(AGI)%
- MATK+(DEX)%
- 火耐性%
- 水耐性%
- 風耐性%
- 地耐性%
- 光耐性%
- 闇耐性%
- 無耐性%
- 直線軽減%
- 突進軽減%
- 弾丸軽減%
- 周囲軽減%
- 範囲軽減%
- 痛床軽減%
- 隕石軽減%
- 射刃軽減%
- 吸引軽減%
- 爆発軽減%
- 物理バリア
- 魔法バリア
- 割合バリア
- バリア速度%
- 物理追撃%
- 魔法追撃%