# 技術要件

## 技術要件
- Next.js 15 + React 19
- TypeScript
- Tailwind CSS v4
- 状態管理: Zustand（軽量で型安全な状態管理）
- フォームバリデーション: Zod + React Hook Form
- Biome（コード品質・フォーマット）

## データ管理要件

### アプリ起動時のプリセットデータ初期化
**アプリ起動時の動作フロー**:
```
アプリ起動 → ストレージチェック → メインデータ存在確認 → [存在しない場合]メインデータ作成 → プリセットデータをローカルストレージにコピー → メインデータをセーブデータに設定
```

**プリセットデータのローカルストレージコピー**:
- 初回アクセス時に以下のプリセットデータをローカルストレージにコピー
  - プリセット装備データ（`src/data/equipments.ts`）※TypeScript型安全版
  - プリセットクリスタデータ（`src/data/crystals.ts`）※TypeScript型安全版
  - プリセット敵情報データ（`src/data/enemies.ts`）※TypeScript型安全版
  - プリセットバフアイテムデータ（`src/data/buffItems.ts`）※TypeScript型安全版
- コピー後は全てローカルストレージから参照
- `isFavorite`プロパティをプリセットデータにも適用可能
- プリセット由来のデータでも数値調整・保存が可能

**TypeScript移行の技術的利点**:
- EquipmentPropertiesインターフェースによる厳密な型チェック
- コンパイル時エラー検出によるデータ整合性確保
- エディタでの自動補完とIntelliSense
- プロパティ名統一の強制（PascalCase + アンダースコア）
- リファクタリング時の型安全性保証

### データ管理方式
- **プリセットデータ**: TypeScriptファイル → 初回時にLocalStorageにコピー
- **ユーザーカスタムデータ**: LocalStorage管理
  - カスタムクリスタ
  - カスタム装備
  - カスタム敵情報
- **統合データアクセス**: ローカルストレージから全データを統一的に管理
- **状態管理**: Zustandによる一元的な状態管理
  - 計算機データの統合管理
  - セーブデータ管理
  - UI状態管理
  - TypeScript型安全性
- データの永続化とインポート/エクスポート対応

### 状態管理アーキテクチャ
**Zustand Store構成**:
- `CalculatorStore`: メインデータ管理（基本ステータス、武器、装備、クリスタ、料理、敵情報、バフスキル、バフアイテム※）
- `SaveDataStore`: セーブデータ管理（作成、切り替え、削除）
- `UIStore`: UI状態管理（モーダル、管理画面表示状態）

※バフアイテムはフェーズ2で追加予定

**React Hook Form統合**:
- Zustandとの双方向バインディング
- リアルタイム変更検知とストア更新
- フォーム初期化の最適化
- セーブデータ切り替え時のちらつき防止

## 開発フェーズ

### フェーズ1（完了）
- 入力フォームの実装（基本ステータス、武器、装備、クリスタ、料理、敵情報）
- 基本的なステータス合計表示
- リアルタイム入力対応
- Zustand状態管理システムの導入
- プリセットクリスタ選択システム（JSONベース + モーダルUI）
- タブ切り替え式装備管理画面
- プリセット装備選択システム（JSONベース + モーダルUI）
- プリセット敵情報選択システム（JSONベース + ドロップダウンUI）
- セーブデータ管理機能（ユーザーデータ専用表示、新規作成時自動切り替え）
- LocalStorageベースのデータ永続化
- 保存ボタンの統一（「現在のデータを保存」に統一、重複削除）
- メインデータ自動切り替え（全ユーザーデータ削除時）

### フェーズ2（次期実装予定）
- **バフアイテムシステムの実装**（高優先度）
  - バフアイテム選択フォームの実装
  - カテゴリ別アイテム選択UI
  - プリセットアイテムデータ管理
  - Zustand状態管理への統合
- **バフスキルシステムの実装**（完了）
  - バフスキル設定フォームの実装
  - スキル系統別のグループ化表示
  - オン/オフ切り替えとパラメータ入力
  - Zustand状態管理への統合
- ダメージ計算ロジックの実装
- 計算結果の詳細表示
- ユーザーによるクリスタ編集・保存機能（LocalStorageベース）
- ユーザーによる装備編集・保存機能（LocalStorageベース）
- ユーザーによる敵情報編集・保存機能（LocalStorageベース）
- 装備・クリスタの組み合わせ最適化機能

### フェーズ3（将来）
- 装備セット保存・読み込み機能
- 複数キャラクター管理機能
- 装備・クリスタ・敵情報データのインポート/エクスポート機能
- 検索・絞り込み機能の強化

## 技術的成果と制約事項

### 技術的成果
- Zustand状態管理による高いパフォーマンス
- React Hook Formとの効率的な統合
- TypeScript型安全性の完全対応
- セーブデータ管理の実装完了
- UI/UXの最適化（ちらつき防止等）

### 制約事項
- ダメージ計算ロジックは複雑なため、フェーズ2で実装予定
- ユーザーカスタムデータ編集機能は次期フェーズで実装
- 表示形式の詳細は後の設計で決定