# 敵情報選択UI改善計画書

## 📋 現状分析

### 既存実装: `NewEnemyForm.tsx`
- 現在は**セレクトボックス形式**で敵選択を実装
- カテゴリフィルター（全て、モブ、フィールドボス、ボス、レイドボス）を提供
- 選択された敵の詳細情報表示（レベル、DEF、MDEF、耐性等）
- 手動調整値入力機能（クリ耐性、必要HIT）

### enemies.jsonの構造
```json
{
  "enemies": {
    "mob": [...],          // モブ敵
    "fieldBoss": [...],    // フィールドボス
    "boss": [...],         // ボス
    "raidBoss": [...]      // レイドボス
  }
}
```

### 各敵データの構造
```typescript
{
  "id": "unique_id",
  "name": "敵名",
  "level": 数値,
  "stats": {
    "DEF": 数値,
    "MDEF": 数値,
    "physicalResistance": 数値,
    "magicalResistance": 数値,
    "resistCritical": 数値,
    "requiredHIT": 数値
  },
  "category": "カテゴリ名"
}
```

## 📝 改善計画

### 1. 目標と要件

#### 1.1 改善目標
- 敵選択UIをクリスタ選択UIと同様のモーダル形式に変更
- タブフィルターによる敵カテゴリ分類の実装
- ユーザビリティとビジュアルの向上

#### 1.2 機能要件
- **モーダル表示**: フルスクリーンモーダルでの敵選択
- **タブフィルター**: 全て、モブ、フィールドボス、ボス、レイドボス
- **カード形式表示**: 敵情報をカード形式で視覚的に表示
- **選択状態**: 現在選択中の敵を明確に表示
- **「なし」オプション**: 敵を選択しない選択肢

#### 1.3 非機能要件
- 既存のZustand統合を維持
- レスポンシブデザイン対応
- アクセシビリティ（キーボード操作、スクリーンリーダー対応）

### 2. 技術仕様

#### 2.1 新規作成コンポーネント

##### EnemySelectionModal.tsx
```typescript
interface EnemySelectionModalProps {
  isOpen: boolean
  onClose: () => void
  onSelect: (enemyId: string | null) => void
  selectedEnemyId: string | null
  title: string
}
```

##### EnemyCard.tsx
```typescript
interface EnemyCardProps {
  enemy: PresetEnemy
  isSelected: boolean
  onClick: () => void
}
```

#### 2.2 修正対象コンポーネント

##### NewEnemyForm.tsx
- セレクトボックスを選択ボタンに変更
- モーダル状態管理の追加
- 選択済み敵情報の表示改善

#### 2.3 データ構造
既存の`enemies.json`構造をそのまま活用:
```typescript
type EnemyCategory = 'mob' | 'fieldBoss' | 'boss' | 'raidBoss'
```

### 3. UI/UXデザイン

#### 3.1 モーダルレイアウト
```
┌─────────────────────────────────────┐
│ ヘッダー（タイトル + 閉じるボタン）    │
├─────────────────────────────────────┤
│ タブフィルター                       │
│ [全て] [モブ] [フィールドボス]...     │
├─────────────────────────────────────┤
│ 敵カード一覧（グリッド表示）          │
│ ┌──────┐ ┌──────┐ ┌──────┐        │
│ │敵カード│ │敵カード│ │敵カード│        │
│ └──────┘ └──────┘ └──────┘        │
├─────────────────────────────────────┤
│ フッター（キャンセルボタン）          │
└─────────────────────────────────────┘
```

#### 3.2 敵カードデザイン
- **敵名**: 大きく表示
- **レベル**: 右上に表示
- **カテゴリ**: バッジ形式で表示
- **主要ステータス**: DEF、MDEF、物理耐性、魔法耐性
- **選択状態**: 青色ボーダー + チェックマーク

#### 3.3 カテゴリ別色分け
- **モブ**: グレー系
- **フィールドボス**: 緑系
- **ボス**: オレンジ系
- **レイドボス**: 赤系

### 4. 実装計画

#### Phase 1: 基盤作成（1日目）
1. **EnemyCard.tsx** の作成
   - 敵情報表示コンポーネント
   - クリスタカードを参考にした設計
   - カテゴリ別色分け

2. **EnemySelectionModal.tsx** の作成
   - CrystalSelectionModalを参考
   - タブフィルター実装
   - グリッド表示

#### Phase 2: 統合（2日目）
3. **NewEnemyForm.tsx** の修正
   - セレクトボックス → ボタン形式
   - モーダル状態管理
   - 選択済み情報表示の改善

4. **動作テスト**
   - 各カテゴリフィルターの動作確認
   - 敵選択・キャンセルの動作確認
   - Zustand統合の確認

#### Phase 3: 仕上げ（3日目）
5. **スタイリング調整**
   - レスポンシブデザイン
   - アニメーション追加
   - アクセシビリティ対応

6. **最終テスト**
   - 全ブラウザ対応確認
   - パフォーマンステスト

### 5. 技術的考慮事項

#### 5.1 パフォーマンス
- 敵データの仮想化（大量データ対応）
- 検索機能の最適化（デバウンス処理）

#### 5.2 互換性
- 既存のZustandストア構造を維持
- 後方互換性の確保

#### 5.3 拡張性
- 将来的な検索機能追加に備えた設計
- ソート機能追加の準備

### 6. リスクと対策

#### 6.1 データ量による表示遅延
- **対策**: 仮想スクロール実装
- **代替案**: ページング機能

#### 6.2 既存機能への影響
- **対策**: 段階的リリース
- **代替案**: フィーチャーフラグ使用

### 7. 参考実装パターン

#### CrystalSelectionModal の実装パターン
- フルスクリーンモーダル (`dialog` 要素使用)
- ヘッダー（タイトル + 閉じるボタン）
- フィルタータブ（タイプ別）
- アイテムグリッド表示
- 「なし」オプション
- フッター（キャンセルボタン）
- ESCキー対応
- 背景クリックで閉じる
- レスポンシブグリッドレイアウト

### 8. 完了基準

- [ ] 全ての敵カテゴリがタブで選択可能
- [ ] 敵カードに必要な情報が適切に表示
- [ ] モーダルの開閉が正常に動作
- [ ] 既存のZustand統合が維持される
- [ ] レスポンシブデザインが適用される
- [ ] アクセシビリティ要件を満たす
- [ ] ESCキーでモーダルが閉じる
- [ ] 背景クリックでモーダルが閉じる
- [ ] タブ切り替えが正常に動作
- [ ] 「なし」オプションが選択可能

### 9. 実装優先度

#### 必須機能（Phase 1）
- 基本的なモーダル表示
- 敵カード表示
- カテゴリタブフィルター
- 敵選択機能

#### 推奨機能（Phase 2）
- アニメーション効果
- 詳細なスタイリング
- レスポンシブ対応

#### オプション機能（Phase 3）
- 検索機能
- ソート機能
- お気に入り機能

---

**作成日**: 2025-01-21  
**バージョン**: 1.0  
**担当**: Claude Code AI